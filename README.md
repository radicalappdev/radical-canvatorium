# radical-canvatorium

### Using this proejct

Using npm version 19 with nvm installed
`nvm use 19`

Install
`npm install`

Running in development mode
`npm run dev`
or
`npm run dev-winows` // to use the self-signed certs on Windows
or
`npm run dev-mac` // to use the self-signed certs on macOS

## Using WebXR with self-signed certs: New cert setup details

WebXR scenes need to be served over HTTPS. While working on the project locally, I often need to test the scene on another device such as an Oculus Quest 2.

This process was created with a little back and forth with ChatGPT in April 2023. I'm documenting it here for future reference.

< start ChatGPT documenation >

> To generate an SSL certificate and key pair for your Nuxt 3 project, follow these steps:

> Create a new file called generate-cert.js in the root directory of your Nuxt 3 project.

> Add the following code to the generate-cert.js file:

```js
const fs = require("fs");
const { promisify } = require("util");
const { createCertificate } = require("tls");

const readFile = promisify(fs.readFile);
const writeFile = promisify(fs.writeFile);

const options = {
  key: null,
  cert: null
};

const generateCertificate = async () => {
  const { privateKey, certificate } = await createCertificate({
    days: 365,
    selfSigned: true
  });

  options.key = privateKey;
  options.cert = certificate;

  await Promise.all([writeFile("key.pem", privateKey), writeFile("cert.pem", certificate)]);

  console.log("SSL certificate and key generated successfully!");
};

const checkCertificate = async () => {
  try {
    await Promise.all([readFile("key.pem"), readFile("cert.pem")]);
    console.log("SSL certificate and key found.");
  } catch (err) {
    console.log("SSL certificate and key not found. Generating new ones...");
    await generateCertificate();
  }
};

checkCertificate();

module.exports = options;
```

> This code defines a function called generateCertificate() that uses the createCertificate() method to generate a self-signed SSL certificate and key pair. The certificate and key are saved to key.pem and cert.pem files in the current directory, and the options are exported so that they can be used in other parts of your Nuxt 3 project.

> The code also defines a function called checkCertificate() that checks whether the certificate and key files already exist. If they do, it logs a message saying that the files were found. If not, it calls the generateCertificate() function to generate new ones.

### Using the SSL certificate and key pair in your Nuxt 3 project

> To use the SSL certificate and key pair generated by the generate-cert.js script in your Nuxt 3 project, follow these steps:

> In your nuxt.config.js file, add the following code at the top:

```js
const options = require("./generate-cert");
```

> This imports the options object from the generate-cert.js file into your nuxt.config.js file, so that you can use it to configure your Nuxt 3 project.

> In your nuxt.config.js file, modify the server section to include the https option, like this:

```js
export default {
  // ...
  server: {
    https: {
      key: options.key,
      cert: options.cert
    }
  }
  // ...
};
```

> This configures the server section to use HTTPS with the SSL certificate and key generated by the `generate-cert.js`

< / end ChatGPT documenation >

## Legacy setup details (for reference)

Running in development mode
`npm run dev -- -o`

### Using self-signed certs with localhost

WebXR scenes need to be served over HTTPS. While working on the project locally, I often need to test the scene on another device such as an Oculus Quest 2. I followed the steps in the article linked below and configured the project with some self-signed certs that will work for local network testing. The browser may still warn or block these certs, but you can click past the warning and access the scene. If you are working with a VR headset attached to your PC, then you can remove the https object from `nuxt.config.js` and/or remove reset the dev script from `"dev": "nuxt dev --https --ssl-cert cert.pem --ssl-key key.pem",` to `"dev": "nuxt dev`

Alternative: you can use ngrok to forward your local dev server to a URL. I found this to be really slow and prone to errors...

Using mkdir to create the certs at the project root

```
mkcert -key-file key.pem -cert-file cert.pem "localhost"
```

Update `nuxt.config.ts` to use the server object with https

```ts
import path from "path";
import fs from "fs";

// https://nuxt.com/docs/api/configuration/nuxt-config
export default defineNuxtConfig({
  modules: ["@nuxtjs/tailwindcss"],
  server: {
    https: {
      key: fs.readFileSync(path.resolve(__dirname, "key.pem")),
      cert: fs.readFileSync(path.resolve(__dirname, "cert.pem"))
    }
  }
});
```

## Licenses

- SVG Maps in `public/assets/maps/` are licensed under the [Creative Commons Attribution 4.0 International (CC BY 4.0)](https://creativecommons.org/licenses/by/4.0/)
- I made the following change to the [Ohio map](https://mapsvg.com/maps/usa-oh) (`usa-oh.svg`) to make it work with the project:

Error: L command and subsequent coordinates.

```svg
m 10.883377,8.7409263 2.924,-0.496 2.885,1.0279998 -2.325,0.386 -1.47,0.217 -1.171,1.6780009 -0.261,0.486 -0.934,0.798 -0.279,0.036 -0.117,-0.942 L 9.7743771,8.9349261 10.883377,8.7409263
```

Fixed: removed the L command and updated the coordinates to be relative.

```svg
m 10.8834 8.7409 l 2.924 -0.496 l 2.885 1.028 l -2.325 0.386 l -1.47 0.217 l -1.171 1.678 l -0.261 0.486 l -0.934 0.798 l -0.279 0.036 l -0.117 -0.942 l -0.3734 -2.9239 l 1.1214 -0.2671
```
