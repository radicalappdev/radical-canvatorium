# radical-canvatorium

### Using this proejct

Using npm version 19 with nvm installed
`nvm use 19`

Install
`npm install`

Running in development mode
`npm run dev -- -o`

### Using self-signed certs with localhost

WebXR scenes need to be served over HTTPS. While working on the project locally, I often need to test the scene on another device such as an Oculus Quest 2. I followed the steps in the article linked below and configured the project with some self-signed certs that will work for local network testing. The browser may still warn or block these certs, but you can click past the warning and access the scene. If you are working with a VR headset attached to your PC, then you can remove the https object from `nuxt.config.js` and/or remove reset the dev script from `"dev": "nuxt dev --https --ssl-cert cert.pem --ssl-key key.pem",` to `"dev": "nuxt dev`

Alternative: you can use ngrok to forward your local dev server to a URL. I found this to be really slow and prone to errors...

Using mkdir to create the certs at the project root

```
mkcert -key-file key.pem -cert-file cert.pem "localhost"
```

Update `nuxt.config.ts` to use the server object with https

```ts
import path from "path";
import fs from "fs";

// https://nuxt.com/docs/api/configuration/nuxt-config
export default defineNuxtConfig({
  modules: ["@nuxtjs/tailwindcss"],
  server: {
    https: {
      key: fs.readFileSync(path.resolve(__dirname, "key.pem")),
      cert: fs.readFileSync(path.resolve(__dirname, "cert.pem"))
    }
  }
});
```

Update the dev script in `package.json` to `"dev": "nuxt dev --https --ssl-cert cert.pem --ssl-key key.pem",`

### Troubleshooting an issue with Vite / Nuxt

When setting up a new Windows machine I was unable to get the project to run. I came to the mac to document the node and npm versions.
macOS is using node v19.8.1 and npm v 9.5.1

I tried to server the mac version and it generated the same error. I looked at the recent commits and the only major change was the inclusion of the babylon-loaders. I commented out the loaders and launched a new terminal window. The project launched successfully.

## New cert setup details

This process was created with a little back and forth with ChatGPT in April 2023. I'm documenting it here for future reference.

To generate an SSL certificate and key pair for your Nuxt 3 project, follow these steps:

Create a new file called generate-cert.js in the root directory of your Nuxt 3 project.

Add the following code to the generate-cert.js file:

```js
const fs = require("fs");
const { promisify } = require("util");
const { createCertificate } = require("tls");

const readFile = promisify(fs.readFile);
const writeFile = promisify(fs.writeFile);

const options = {
  key: null,
  cert: null
};

const generateCertificate = async () => {
  const { privateKey, certificate } = await createCertificate({
    days: 365,
    selfSigned: true
  });

  options.key = privateKey;
  options.cert = certificate;

  await Promise.all([writeFile("key.pem", privateKey), writeFile("cert.pem", certificate)]);

  console.log("SSL certificate and key generated successfully!");
};

const checkCertificate = async () => {
  try {
    await Promise.all([readFile("key.pem"), readFile("cert.pem")]);
    console.log("SSL certificate and key found.");
  } catch (err) {
    console.log("SSL certificate and key not found. Generating new ones...");
    await generateCertificate();
  }
};

checkCertificate();

module.exports = options;
```

This code defines a function called generateCertificate() that uses the createCertificate() method to generate a self-signed SSL certificate and key pair. The certificate and key are saved to key.pem and cert.pem files in the current directory, and the options are exported so that they can be used in other parts of your Nuxt 3 project.

The code also defines a function called checkCertificate() that checks whether the certificate and key files already exist. If they do, it logs a message saying that the files were found. If not, it calls the generateCertificate() function to generate new ones.

### Using the SSL certificate and key pair in your Nuxt 3 project

To use the SSL certificate and key pair generated by the generate-cert.js script in your Nuxt 3 project, follow these steps:

In your nuxt.config.js file, add the following code at the top:

```js
const options = require("./generate-cert");
```

This imports the options object from the generate-cert.js file into your nuxt.config.js file, so that you can use it to configure your Nuxt 3 project.

In your nuxt.config.js file, modify the server section to include the https option, like this:

```js
export default {
  // ...
  server: {
    https: {
      key: options.key,
      cert: options.cert
    }
  }
  // ...
};
```

This configures the server section to use HTTPS with the SSL certificate and key generated by the `generate-cert.js
